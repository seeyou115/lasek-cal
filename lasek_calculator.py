import streamlit as st

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ë¼ì„¹ ìˆ˜ìˆ  ê³„ì‚°ê¸°", page_icon="ğŸ‘ï¸", layout="centered")

# ì œëª©
st.title("ğŸ‘ï¸ ë¼ì„¹ ìˆ˜ìˆ  ë…¸ëª¨ê·¸ë¨ ê³„ì‚°ê¸°")
st.markdown("---")

# ì„¤ëª…
st.markdown("""
### ì‚¬ìš© ë°©ë²•
í™˜ìì˜ êµ´ì ˆ ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•˜ì‹œë©´ ë…¸ëª¨ê·¸ë¨ì— ë”°ë¼ ì¡°ì •ëœ ì ˆì‚­ ìˆ˜ì¹˜ì™€ ì´ ì ˆì‚­ëŸ‰ì„ ìë™ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.
""")

# ì…ë ¥ ì„¹ì…˜
col1, col2 = st.columns(2)

with col1:
    sph_input = st.number_input(
        "SPH (êµ¬ë©´ë Œì¦ˆ ë„ìˆ˜)", 
        min_value=-15.0, 
        max_value=5.0, 
        value=0.0, 
        step=0.25,
        format="%.2f"
    )

with col2:
    cyl_input = st.number_input(
        "CYL (ë‚œì‹œ ë„ìˆ˜)", 
        min_value=-10.0, 
        max_value=0.0, 
        value=0.0, 
        step=0.25,
        format="%.2f"
    )

st.markdown("---")


# WFO Ablation Depth í…Œì´ë¸” ì¡°íšŒ í•¨ìˆ˜
def get_ablation_depth(sph, cyl):
    """
    ì ˆì‚­ SPHì™€ CYL ê°’ìœ¼ë¡œ ì´ ì ˆì‚­ ê¹Šì´(micron)ë¥¼ ì°¾ëŠ” í•¨ìˆ˜
    í‘œì— ì •í™•í•œ ê°’ì´ ì—†ìœ¼ë©´ ê°€ì¥ ê°€ê¹Œìš´ ê°’ìœ¼ë¡œ ê·¼ì‚¬
    """
    # WFO Ablation Depth í…Œì´ë¸” (SPH í–‰, CYL ì—´)
    ablation_table = {
        0.00: {0.00: 0, -0.25: 3, -0.50: 7, -0.75: 10, -1.00: 13, -1.25: 16, -1.50: 19, -1.75: 23, -2.00: 26, -2.25: 29, -2.50: 32, -2.75: 35, -3.00: 38, -3.25: 41, -3.50: 44, -3.75: 47, -4.00: 50, -4.25: 53, -4.50: 56, -4.75: 59, -5.00: 62, -5.25: 65, -5.50: 68, -5.75: 71, -6.00: 74},
        -0.25: {0.00: 3, -0.25: 7, -0.50: 10, -0.75: 13, -1.00: 16, -1.25: 19, -1.50: 23, -1.75: 26, -2.00: 29, -2.25: 32, -2.50: 35, -2.75: 38, -3.00: 41, -3.25: 44, -3.50: 47, -3.75: 50, -4.00: 53, -4.25: 56, -4.50: 59, -4.75: 62, -5.00: 65, -5.25: 68, -5.50: 71, -5.75: 74, -6.00: 77},
        -0.50: {0.00: 7, -0.25: 10, -0.50: 13, -0.75: 16, -1.00: 19, -1.25: 23, -1.50: 26, -1.75: 29, -2.00: 32, -2.25: 35, -2.50: 38, -2.75: 41, -3.00: 44, -3.25: 47, -3.50: 50, -3.75: 53, -4.00: 56, -4.25: 59, -4.50: 62, -4.75: 65, -5.00: 68, -5.25: 71, -5.50: 74, -5.75: 77, -6.00: 79},
        -0.75: {0.00: 10, -0.25: 13, -0.50: 16, -0.75: 20, -1.00: 23, -1.25: 26, -1.50: 29, -1.75: 32, -2.00: 35, -2.25: 38, -2.50: 41, -2.75: 44, -3.00: 47, -3.25: 50, -3.50: 53, -3.75: 56, -4.00: 59, -4.25: 62, -4.50: 65, -4.75: 68, -5.00: 71, -5.25: 74, -5.50: 77, -5.75: 79, -6.00: 82},
        -1.00: {0.00: 13, -0.25: 16, -0.50: 20, -0.75: 23, -1.00: 26, -1.25: 29, -1.50: 32, -1.75: 35, -2.00: 38, -2.25: 41, -2.50: 44, -2.75: 47, -3.00: 50, -3.25: 53, -3.50: 56, -3.75: 59, -4.00: 62, -4.25: 65, -4.50: 68, -4.75: 71, -5.00: 74, -5.25: 77, -5.50: 80, -5.75: 82, -6.00: 85},
        -1.25: {0.00: 16, -0.25: 20, -0.50: 23, -0.75: 26, -1.00: 29, -1.25: 32, -1.50: 35, -1.75: 38, -2.00: 41, -2.25: 44, -2.50: 47, -2.75: 50, -3.00: 53, -3.25: 56, -3.50: 59, -3.75: 62, -4.00: 65, -4.25: 68, -4.50: 71, -4.75: 74, -5.00: 77, -5.25: 80, -5.50: 82, -5.75: 85, -6.00: 88},
        -1.50: {0.00: 20, -0.25: 23, -0.50: 26, -0.75: 29, -1.00: 32, -1.25: 35, -1.50: 38, -1.75: 41, -2.00: 45, -2.25: 48, -2.50: 51, -2.75: 54, -3.00: 56, -3.25: 59, -3.50: 62, -3.75: 65, -4.00: 68, -4.25: 71, -4.50: 74, -4.75: 77, -5.00: 80, -5.25: 82, -5.50: 85, -5.75: 88, -6.00: 91},
        -1.75: {0.00: 23, -0.25: 26, -0.50: 29, -0.75: 32, -1.00: 35, -1.25: 38, -1.50: 42, -1.75: 45, -2.00: 48, -2.25: 51, -2.50: 54, -2.75: 57, -3.00: 59, -3.25: 62, -3.50: 65, -3.75: 68, -4.00: 71, -4.25: 74, -4.50: 77, -4.75: 80, -5.00: 83, -5.25: 85, -5.50: 88, -5.75: 91, -6.00: 94},
        -2.00: {0.00: 26, -0.25: 29, -0.50: 32, -0.75: 35, -1.00: 39, -1.25: 42, -1.50: 45, -1.75: 48, -2.00: 51, -2.25: 54, -2.50: 57, -2.75: 60, -3.00: 62, -3.25: 65, -3.50: 68, -3.75: 71, -4.00: 74, -4.25: 77, -4.50: 80, -4.75: 83, -5.00: 85, -5.25: 88, -5.50: 91, -5.75: 94, -6.00: 96},
        -2.25: {0.00: 29, -0.25: 32, -0.50: 36, -0.75: 39, -1.00: 42, -1.25: 45, -1.50: 48, -1.75: 51, -2.00: 54, -2.25: 57, -2.50: 60, -2.75: 63, -3.00: 65, -3.25: 68, -3.50: 71, -3.75: 74, -4.00: 77, -4.25: 80, -4.50: 83, -4.75: 85, -5.00: 88, -5.25: 91, -5.50: 94, -5.75: 96, -6.00: 99},
        -2.50: {0.00: 33, -0.25: 36, -0.50: 39, -0.75: 42, -1.00: 45, -1.25: 48, -1.50: 51, -1.75: 54, -2.00: 57, -2.25: 60, -2.50: 63, -2.75: 65, -3.00: 68, -3.25: 71, -3.50: 74, -3.75: 77, -4.00: 80, -4.25: 83, -4.50: 85, -4.75: 88, -5.00: 91, -5.25: 94, -5.50: 97, -5.75: 99, -6.00: 102},
        -2.75: {0.00: 36, -0.25: 39, -0.50: 42, -0.75: 45, -1.00: 48, -1.25: 51, -1.50: 54, -1.75: 57, -2.00: 60, -2.25: 63, -2.50: 66, -2.75: 68, -3.00: 71, -3.25: 74, -3.50: 77, -3.75: 80, -4.00: 83, -4.25: 86, -4.50: 88, -4.75: 91, -5.00: 94, -5.25: 97, -5.50: 99, -5.75: 102, -6.00: 105},
        -3.00: {0.00: 39, -0.25: 42, -0.50: 45, -0.75: 48, -1.00: 51, -1.25: 54, -1.50: 57, -1.75: 60, -2.00: 63, -2.25: 66, -2.50: 69, -2.75: 71, -3.00: 74, -3.25: 77, -3.50: 80, -3.75: 83, -4.00: 86, -4.25: 88, -4.50: 91, -4.75: 94, -5.00: 97, -5.25: 99, -5.50: 102, -5.75: 105, -6.00: 107},
        -3.25: {0.00: 42, -0.25: 45, -0.50: 48, -0.75: 51, -1.00: 54, -1.25: 57, -1.50: 60, -1.75: 63, -2.00: 66, -2.25: 69, -2.50: 71, -2.75: 74, -3.00: 77, -3.25: 80, -3.50: 83, -3.75: 86, -4.00: 88, -4.25: 91, -4.50: 94, -4.75: 97, -5.00: 99, -5.25: 102, -5.50: 105, -5.75: 108, -6.00: 110},
        -3.50: {0.00: 45, -0.25: 48, -0.50: 51, -0.75: 54, -1.00: 57, -1.25: 60, -1.50: 63, -1.75: 66, -2.00: 69, -2.25: 71, -2.50: 74, -2.75: 77, -3.00: 80, -3.25: 83, -3.50: 86, -3.75: 88, -4.00: 91, -4.25: 94, -4.50: 97, -4.75: 99, -5.00: 102, -5.25: 105, -5.50: 108, -5.75: 110, -6.00: 113},
        -3.75: {0.00: 48, -0.25: 51, -0.50: 54, -0.75: 57, -1.00: 60, -1.25: 63, -1.50: 66, -1.75: 69, -2.00: 72, -2.25: 74, -2.50: 77, -2.75: 80, -3.00: 83, -3.25: 86, -3.50: 89, -3.75: 91, -4.00: 94, -4.25: 97, -4.50: 100, -4.75: 102, -5.00: 105, -5.25: 108, -5.50: 110, -5.75: 113, -6.00: 116},
        -4.00: {0.00: 51, -0.25: 54, -0.50: 57, -0.75: 60, -1.00: 63, -1.25: 66, -1.50: 69, -1.75: 72, -2.00: 74, -2.25: 77, -2.50: 80, -2.75: 83, -3.00: 86, -3.25: 89, -3.50: 91, -3.75: 94, -4.00: 97, -4.25: 100, -4.50: 102, -4.75: 105, -5.00: 108, -5.25: 110, -5.50: 113, -5.75: 116, -6.00: 118},
        -4.25: {0.00: 54, -0.25: 57, -0.50: 60, -0.75: 63, -1.00: 66, -1.25: 69, -1.50: 72, -1.75: 75, -2.00: 77, -2.25: 80, -2.50: 83, -2.75: 86, -3.00: 89, -3.25: 91, -3.50: 94, -3.75: 97, -4.00: 100, -4.25: 102, -4.50: 105, -4.75: 108, -5.00: 110, -5.25: 113, -5.50: 116, -5.75: 118, -6.00: 121},
        -4.50: {0.00: 57, -0.25: 60, -0.50: 63, -0.75: 66, -1.00: 69, -1.25: 72, -1.50: 75, -1.75: 77, -2.00: 80, -2.25: 83, -2.50: 86, -2.75: 89, -3.00: 91, -3.25: 94, -3.50: 97, -3.75: 100, -4.00: 102, -4.25: 105, -4.50: 108, -4.75: 110, -5.00: 113, -5.25: 116, -5.50: 118, -5.75: 121, -6.00: 124},
        -4.75: {0.00: 60, -0.25: 63, -0.50: 66, -0.75: 69, -1.00: 72, -1.25: 75, -1.50: 77, -1.75: 80, -2.00: 83, -2.25: 86, -2.50: 89, -2.75: 91, -3.00: 94, -3.25: 97, -3.50: 100, -3.75: 102, -4.00: 105, -4.25: 108, -4.50: 111, -4.75: 113, -5.00: 116, -5.25: 118, -5.50: 121, -5.75: 124, -6.00: 126},
        -5.00: {0.00: 63, -0.25: 66, -0.50: 69, -0.75: 72, -1.00: 75, -1.25: 78, -1.50: 80, -1.75: 83, -2.00: 86, -2.25: 89, -2.50: 92, -2.75: 94, -3.00: 97, -3.25: 100, -3.50: 102, -3.75: 105, -4.00: 108, -4.25: 111, -4.50: 113, -4.75: 116, -5.00: 118, -5.25: 121, -5.50: 124, -5.75: 126, -6.00: 129},
        -5.25: {0.00: 66, -0.25: 69, -0.50: 72, -0.75: 75, -1.00: 78, -1.25: 80, -1.50: 83, -1.75: 86, -2.00: 89, -2.25: 92, -2.50: 94, -2.75: 97, -3.00: 100, -3.25: 103, -3.50: 105, -3.75: 108, -4.00: 111, -4.25: 113, -4.50: 116, -4.75: 119, -5.00: 121, -5.25: 124, -5.50: 126, -5.75: 129, -6.00: 131},
        -5.50: {0.00: 69, -0.25: 72, -0.50: 75, -0.75: 78, -1.00: 80, -1.25: 83, -1.50: 86, -1.75: 89, -2.00: 92, -2.25: 94, -2.50: 97, -2.75: 100, -3.00: 103, -3.25: 105, -3.50: 108, -3.75: 111, -4.00: 113, -4.25: 116, -4.50: 119, -4.75: 121, -5.00: 124, -5.25: 126, -5.50: 129, -5.75: 132, -6.00: 134},
        -5.75: {0.00: 72, -0.25: 75, -0.50: 78, -0.75: 81, -1.00: 83, -1.25: 86, -1.50: 89, -1.75: 92, -2.00: 94, -2.25: 97, -2.50: 100, -2.75: 103, -3.00: 105, -3.25: 108, -3.50: 111, -3.75: 113, -4.00: 116, -4.25: 119, -4.50: 121, -4.75: 124, -5.00: 126, -5.25: 129, -5.50: 132, -5.75: 134, -6.00: 137},
        -6.00: {0.00: 75, -0.25: 78, -0.50: 81, -0.75: 83, -1.00: 86, -1.25: 89, -1.50: 92, -1.75: 95, -2.00: 97, -2.25: 100, -2.50: 103, -2.75: 105, -3.00: 108, -3.25: 111, -3.50: 113, -3.75: 116, -4.00: 119, -4.25: 121, -4.50: 124, -4.75: 126, -5.00: 129, -5.25: 132, -5.50: 134, -5.75: 137, -6.00: 139},
    }
    
    # 0.25 ë‹¨ìœ„ë¡œ ë°˜ì˜¬ë¦¼
    sph_rounded = round(sph / 0.25) * 0.25
    cyl_rounded = round(cyl / 0.25) * 0.25
    
    # í…Œì´ë¸” ë²”ìœ„ í™•ì¸
    sph_rounded = max(-6.00, min(0.00, sph_rounded))
    cyl_rounded = max(-6.00, min(0.00, cyl_rounded))
    
    # í…Œì´ë¸”ì—ì„œ ê°’ ì°¾ê¸°
    if sph_rounded in ablation_table and cyl_rounded in ablation_table[sph_rounded]:
        return ablation_table[sph_rounded][cyl_rounded]
    else:
        return None


# ê³„ì‚° ë²„íŠ¼
if st.button("ğŸ” ì ˆì‚­ ìˆ˜ì¹˜ ê³„ì‚°", type="primary", use_container_width=True):
    
    # ì´ˆê¸°ê°’: ì…ë ¥ê°’ ê·¸ëŒ€ë¡œ
    adjusted_sph = sph_input
    adjustment = 0.0
    reason = "ì¡°ì • ì—†ìŒ"
    
    # ë…¸ëª¨ê·¸ë¨ ë¡œì§ (ì ˆì°¨ì ìœ¼ë¡œ ë‹¨ê³„ë³„ í™•ì¸)
    
    # 1ë‹¨ê³„: SPHê°€ 0ì¸ ê²½ìš°
    if sph_input == 0:
        if -5.0 <= cyl_input <= -0.25:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = "SPH=0, CYLì´ -0.25~-5.0 ë²”ìœ„"
        else:
            reason = "SPH=0, CYLì´ ë²”ìœ„ ë°–"
    
    # 2ë‹¨ê³„: SPHê°€ -0.25 ~ -0.75ì¸ ê²½ìš°
    elif -0.75 <= sph_input <= -0.25:
        if -5.0 <= cyl_input <= -0.25:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = f"SPH={sph_input}, CYLì´ -0.25~-5.0 ë²”ìœ„"
        else:
            reason = f"SPH={sph_input}, CYLì´ ë²”ìœ„ ë°–"
    
    # 3ë‹¨ê³„: SPHê°€ -1.00 ~ -1.25ì¸ ê²½ìš°
    elif -1.25 <= sph_input <= -1.00:
        if -4.75 <= cyl_input <= -0.25:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = f"SPH={sph_input}, CYLì´ -0.25~-4.75 ë²”ìœ„"
        else:
            reason = f"SPH={sph_input}, CYLì´ ë²”ìœ„ ë°–"
    
    # 4ë‹¨ê³„: SPHê°€ -1.50ì¸ ê²½ìš°
    elif sph_input == -1.50:
        if -4.5 <= cyl_input <= -0.25:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = "SPH=-1.50, CYLì´ -0.25~-4.5 ë²”ìœ„"
        else:
            reason = "SPH=-1.50, CYLì´ ë²”ìœ„ ë°–"
    
    # 5ë‹¨ê³„: SPHê°€ -1.75ì¸ ê²½ìš°
    elif sph_input == -1.75:
        if -4.25 <= cyl_input <= -0.25:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = "SPH=-1.75, CYLì´ -0.25~-4.25 ë²”ìœ„"
        else:
            reason = "SPH=-1.75, CYLì´ ë²”ìœ„ ë°–"
    
    # 6ë‹¨ê³„: SPHê°€ -2.00ì¸ ê²½ìš°
    elif sph_input == -2.00:
        if -4.0 <= cyl_input <= -0.25:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = "SPH=-2.00, CYLì´ -0.25~-4.0 ë²”ìœ„"
        else:
            reason = "SPH=-2.00, CYLì´ ë²”ìœ„ ë°–"
    
    # 7ë‹¨ê³„: SPHê°€ -2.25ì¸ ê²½ìš°
    elif sph_input == -2.25:
        if -3.5 <= cyl_input <= -0.25:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = "SPH=-2.25, CYLì´ -0.25~-3.5 ë²”ìœ„"
        else:
            reason = "SPH=-2.25, CYLì´ ë²”ìœ„ ë°–"
    
    # 8ë‹¨ê³„: SPHê°€ -2.50ì¸ ê²½ìš°
    elif sph_input == -2.50:
        if -2.75 <= cyl_input <= -1.00:
            adjustment = -0.25
            adjusted_sph = sph_input - 0.25
            reason = "SPH=-2.50, CYLì´ -1.00~-2.75 ë²”ìœ„"
        else:
            reason = "SPH=-2.50, CYLì´ ë²”ìœ„ ë°–"
    
    # 9ë‹¨ê³„: SPHê°€ -2.75 ~ -4.50ì¸ ê²½ìš°
    elif -4.50 <= sph_input <= -2.75:
        reason = f"SPH={sph_input}, CYL ìƒê´€ì—†ì´ ì¡°ì • ì—†ìŒ"
    
    # 10ë‹¨ê³„: SPHê°€ -4.75ì¸ ê²½ìš°
    elif sph_input == -4.75:
        if cyl_input >= -5.75:
            adjustment = 0.25
            adjusted_sph = sph_input + 0.25
            reason = "SPH=-4.75, CYLì´ -5.75 ì´ìƒ"
        else:
            reason = "SPH=-4.75, CYLì´ ë²”ìœ„ ë°–"
    
    # 11ë‹¨ê³„: SPHê°€ -5.00ì¸ ê²½ìš°
    elif sph_input == -5.00:
        if cyl_input >= -5.00:
            adjustment = 0.25
            adjusted_sph = sph_input + 0.25
            reason = "SPH=-5.00, CYLì´ -5.00 ì´ìƒ"
        else:
            reason = "SPH=-5.00, CYLì´ ë²”ìœ„ ë°–"
    
    # 12ë‹¨ê³„: SPHê°€ -5.25ì¸ ê²½ìš°
    elif sph_input == -5.25:
        if cyl_input >= -3.75:
            adjustment = 0.25
            adjusted_sph = sph_input + 0.25
            reason = "SPH=-5.25, CYLì´ -3.75 ì´ìƒ"
        else:
            reason = "SPH=-5.25, CYLì´ ë²”ìœ„ ë°–"
    
    # 13ë‹¨ê³„: SPHê°€ -5.50 ~ -6.50ì¸ ê²½ìš°
    elif -6.50 <= sph_input <= -5.50:
        adjustment = 0.25
        adjusted_sph = sph_input + 0.25
        reason = f"SPH={sph_input}, CYL ìƒê´€ì—†ì´ +0.25"
    
    # 14ë‹¨ê³„: SPHê°€ -6.75ì¸ ê²½ìš°
    elif sph_input == -6.75:
        if cyl_input <= -5.00:
            adjustment = 0.25
            adjusted_sph = sph_input + 0.25
            reason = "SPH=-6.75, CYLì´ -5.00 ì´í•˜"
        else:
            adjustment = 0.50
            adjusted_sph = sph_input + 0.50
            reason = "SPH=-6.75, CYLì´ -5.00 ì´ˆê³¼"
    
    # 15ë‹¨ê³„: SPHê°€ -7.00ì¸ ê²½ìš°
    elif sph_input == -7.00:
        if cyl_input <= -3.75:
            adjustment = 0.25
            adjusted_sph = sph_input + 0.25
            reason = "SPH=-7.00, CYLì´ -3.75 ì´í•˜"
        else:
            adjustment = 0.50
            adjusted_sph = sph_input + 0.50
            reason = "SPH=-7.00, CYLì´ -3.75 ì´ˆê³¼"
    
    # 16ë‹¨ê³„: SPHê°€ -7.25 ~ -7.75ì¸ ê²½ìš°
    elif -7.75 <= sph_input <= -7.25:
        adjustment = 0.50
        adjusted_sph = sph_input + 0.50
        reason = f"SPH={sph_input}, CYL ìƒê´€ì—†ì´ +0.50"
    
    # 17ë‹¨ê³„: SPHê°€ -8.00ì¸ ê²½ìš°
    elif sph_input == -8.00:
        if cyl_input <= -4.75:
            adjustment = 0.50
            adjusted_sph = sph_input + 0.50
            reason = "SPH=-8.00, CYLì´ -4.75 ì´í•˜"
        else:
            adjustment = 0.75
            adjusted_sph = sph_input + 0.75
            reason = "SPH=-8.00, CYLì´ -4.75 ì´ˆê³¼"
    
    # 18ë‹¨ê³„: SPHê°€ -8.25ì¸ ê²½ìš°
    elif sph_input == -8.25:
        if -2.75 <= cyl_input <= -1.00:
            adjustment = 0.50
            adjusted_sph = sph_input + 0.50
            reason = "SPH=-8.25, CYLì´ -1.00~-2.75"
        else:
            adjustment = 0.75
            adjusted_sph = sph_input + 0.75
            reason = "SPH=-8.25, CYLì´ ë²”ìœ„ ë°–"
    
    # 19ë‹¨ê³„: SPHê°€ -8.50 ~ -9.50ì¸ ê²½ìš°
    elif -9.50 <= sph_input <= -8.50:
        adjustment = 0.75
        adjusted_sph = sph_input + 0.75
        reason = f"SPH={sph_input}, CYL ìƒê´€ì—†ì´ +0.75"
    
    # 20ë‹¨ê³„: SPHê°€ -9.75 ~ -10.25ì¸ ê²½ìš°
    elif -10.25 <= sph_input <= -9.75:
        adjustment = 1.00
        adjusted_sph = sph_input + 1.00
        reason = f"SPH={sph_input}, CYL ìƒê´€ì—†ì´ +1.00"
    
    # ê²°ê³¼ ì¶œë ¥
    st.success("âœ… ê³„ì‚° ì™„ë£Œ!")
    
    # SPH ê²°ê³¼ ë°•ìŠ¤
    st.markdown("### ğŸ“Š SPH (êµ¬ë©´ë Œì¦ˆ) ê²°ê³¼")
    result_col1, result_col2, result_col3 = st.columns(3)
    
    with result_col1:
        st.metric(label="ì…ë ¥ SPH", value=f"{sph_input:.2f}")
    
    with result_col2:
        st.metric(label="ì¡°ì •ê°’", value=f"{adjustment:+.2f}" if adjustment != 0 else "0.00")
    
    with result_col3:
        st.metric(label="ì ˆì‚­ SPH", value=f"{adjusted_sph:.2f}", delta=f"{adjustment:+.2f}" if adjustment != 0 else None)
    
    st.info(f"ğŸ“‹ ì ìš© ê·œì¹™: {reason}")
    
    # CYL ì¡°ì • ë¡œì§ ì¶”ê°€
    st.markdown("---")
    st.markdown("### ğŸ“Š CYL (ë‚œì‹œ) ê²°ê³¼")
    
    # ì´ˆê¸°ê°’: CYL ê·¸ëŒ€ë¡œ
    adjusted_cyl = cyl_input
    cyl_adjustment = 0.0
    cyl_reason = "ì¡°ì • ì—†ìŒ"
    
    # CYL ê°’ì— ë”°ë¥¸ ì¡°ì • (ì ˆì°¨ì ìœ¼ë¡œ ë‹¨ê³„ë³„ í™•ì¸)
    if cyl_input >= -1.75:
        # -1.75 ì´í•˜(ì¦‰, 0ì— ê°€ê¹Œìš´ ê°’)ë©´ ê·¸ëŒ€ë¡œ
        cyl_reason = "CYLì´ -1.75 ì´í•˜ (ê·¸ëŒ€ë¡œ)"
    
    elif -2.75 <= cyl_input <= -2.00:
        # -2.00 ~ -2.75 ë²”ìœ„
        cyl_adjustment = 0.25
        adjusted_cyl = cyl_input + 0.25
        cyl_reason = "CYLì´ -2.00~-2.75 ë²”ìœ„ (+0.25)"
    
    elif -3.75 <= cyl_input <= -3.00:
        # -3.00 ~ -3.75 ë²”ìœ„
        cyl_adjustment = 0.50
        adjusted_cyl = cyl_input + 0.50
        cyl_reason = "CYLì´ -3.00~-3.75 ë²”ìœ„ (+0.50)"
    
    elif -4.75 <= cyl_input <= -4.00:
        # -4.00 ~ -4.75 ë²”ìœ„
        cyl_adjustment = 0.75
        adjusted_cyl = cyl_input + 0.75
        cyl_reason = "CYLì´ -4.00~-4.75 ë²”ìœ„ (+0.75)"
    
    elif cyl_input == -5.00 or cyl_input == -5.25:
        # -5.00, -5.25
        cyl_adjustment = 1.00
        adjusted_cyl = cyl_input + 1.00
        cyl_reason = "CYLì´ -5.00 ë˜ëŠ” -5.25 (+1.00)"
    
    elif cyl_input <= -5.50:
        # -5.50 ì´ìƒ (ë” í° ìŒìˆ˜)
        cyl_adjustment = 1.25
        adjusted_cyl = cyl_input + 1.25
        cyl_reason = "CYLì´ -5.50 ì´ìƒ (+1.25)"
    
    # CYL ê²°ê³¼ ì¶œë ¥
    cyl_result_col1, cyl_result_col2, cyl_result_col3 = st.columns(3)
    
    with cyl_result_col1:
        st.metric(label="ì…ë ¥ CYL", value=f"{cyl_input:.2f}")
    
    with cyl_result_col2:
        st.metric(label="ì¡°ì •ê°’", value=f"{cyl_adjustment:+.2f}" if cyl_adjustment != 0 else "0.00")
    
    with cyl_result_col3:
        st.metric(label="ì ˆì‚­ CYL", value=f"{adjusted_cyl:.2f}", delta=f"{cyl_adjustment:+.2f}" if cyl_adjustment != 0 else None)
    
    st.info(f"ğŸ“‹ ì ìš© ê·œì¹™: {cyl_reason}")
    
    # ì´ ì ˆì‚­ëŸ‰ ê³„ì‚° ë° í‘œì‹œ
    st.markdown("---")
    st.markdown("### ğŸ¯ ì´ ì ˆì‚­ëŸ‰ (Ablation Depth)")
    
    ablation_depth = get_ablation_depth(adjusted_sph, adjusted_cyl)
    
    if ablation_depth is not None:
        # ì´ ì ˆì‚­ëŸ‰ í‘œì‹œ
        depth_col1, depth_col2 = st.columns(2)
        
        with depth_col1:
            st.metric(
                label="ì´ ì ˆì‚­ ê¹Šì´", 
                value=f"{ablation_depth} Î¼m",
                help="ì ˆì‚­ SPHì™€ CYL ê°’ì— ë”°ë¥¸ ì´ ê°ë§‰ ì ˆì‚­ ê¹Šì´"
            )
        
        with depth_col2:
            st.metric(
                label="ì¡°íšŒ ê¸°ì¤€",
                value=f"SPH {adjusted_sph:.2f} / CYL {adjusted_cyl:.2f}",
                help="WFO Ablation Depth Table ê¸°ì¤€"
            )
        
        # ì•ˆì „ì„± í‰ê°€
        if ablation_depth < 80:
            st.success(f"âœ… ì ˆì‚­ëŸ‰ì´ {ablation_depth}Î¼mìœ¼ë¡œ ì•ˆì „ ë²”ìœ„ ë‚´ì…ë‹ˆë‹¤.")
        elif ablation_depth < 120:
            st.warning(f"âš ï¸ ì ˆì‚­ëŸ‰ì´ {ablation_depth}Î¼mì…ë‹ˆë‹¤. ê°ë§‰ ë‘ê»˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
        else:
            st.error(f"ğŸš¨ ì ˆì‚­ëŸ‰ì´ {ablation_depth}Î¼mìœ¼ë¡œ ë†’ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•œ ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.")
    else:
        st.warning("âš ï¸ ì…ë ¥ê°’ì´ ì ˆì‚­ëŸ‰ í‘œì˜ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.")

# í•˜ë‹¨ ì•ˆë‚´
st.markdown("---")
st.markdown("""
<div style='text-align: center; color: gray; font-size: 0.9em;'>
    <p>âš ï¸ ë³¸ ê³„ì‚°ê¸°ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤. ì‹¤ì œ ìˆ˜ìˆ  ì‹œ ì˜ì‚¬ì˜ íŒë‹¨ì´ ìµœìš°ì„ ì…ë‹ˆë‹¤.</p>
    <p>ğŸ“Œ ì´ ì ˆì‚­ëŸ‰ì€ WFO Ablation Depth Table (OZ: 6.0mm, K: 43D, VD: 12)ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
</div>
""", unsafe_allow_html=True)
